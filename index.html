<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planillas Tom Tom Wok</title>
    <meta name="description"
        content="Sistema profesional de gesti√≥n de planillas y control de horas para restaurantes.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="calculator.css">
    <link rel="icon" type="image/png" href="favicon.png?v=2">
</head>

<body>
    <!-- Vista de Login -->
    <div id="login-view" class="login-screen" style="display: none;">
        <div class="login-card">
            <img src="img/logo_tom_tom_wok_white.png" alt="Tom Tom Wok Logo" style="width: 200px; margin-bottom: 2rem;">
            <p style="color: var(--text-muted); margin-bottom: 1rem;">Sistema de Control de Planillas</p>

            <div id="login-error" class="login-error">
                Usuario o contrase√±a incorrectos.
            </div>

            <div id="login-mode-selector"
                style="display: flex; gap: 10px; margin-bottom: 2rem; background: rgba(255,255,255,0.05); padding: 5px; border-radius: 12px;">
                <button class="btn" id="btn-mode-admin"
                    style="flex: 1; font-size: 0.85rem; background: var(--primary); color: white;">Administrador</button>
                <button class="btn" id="btn-mode-emp"
                    style="flex: 1; font-size: 0.85rem; background: transparent; color: var(--text-muted);">Soy
                    Empleado</button>
            </div>

            <form class="login-form" id="login-form">
                <!-- Campos para Admin -->
                <div id="admin-fields">
                    <div class="login-input-group">
                        <label>Usuario</label>
                        <input type="text" id="username" placeholder="admin">
                    </div>
                    <div class="login-input-group">
                        <label>Contrase√±a</label>
                        <div class="password-wrapper">
                            <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <button type="button" class="password-toggle"
                                onclick="window.togglePassword('password')"><svg width="20" height="20"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
                                    stroke-linecap="round" stroke-linejoin="round" style="pointer-events:none">
                                    <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
                                    <circle cx="12" cy="12" r="3" />
                                </svg></button>
                        </div>
                    </div>
                </div>

                <!-- Campos para Empleado (PIN) -->
                <div id="employee-fields" style="display: none;">
                    <div class="login-input-group">
                        <label>Ingrese su PIN de 4 d√≠gitos</label>
                        <input type="password" id="employee-pin" placeholder="0000" maxlength="4" inputmode="numeric"
                            style="text-align: center; font-size: 1.5rem; letter-spacing: 12px;">
                    </div>
                </div>

                <button type="submit" class="login-btn" id="submit-login">Entrar al Sistema</button>
            </form>

            <p style="margin-top: 2rem; font-size: 0.8rem; color: var(--text-muted)">
                ¬© 2026 Tom Tom Wok
            </p>
        </div>
    </div>

    <!-- Loader Global -->
    <div id="loader-overlay"
        style="display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.9); z-index: 10000; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(10px);">
        <div class="loader-spinner"></div>
        <div id="loader-text" style="color: white; margin-top: 1.5rem; font-weight: 500; font-size: 1.1rem;">Procesando
            datos...</div>
        <div
            style="width: 300px; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 1rem; overflow: hidden;">
            <div id="loader-progress"
                style="width: 0%; height: 100%; background: var(--primary); transition: width 0.3s ease;"></div>
        </div>
    </div>

    <!-- App Container -->
    <div id="app" style="display: none;">
        <aside class="sidebar" id="sidebar">
            <button class="menu-close" id="menu-close">‚úï</button>
            <div class="logo">
                <img src="img/logo_tom_tom_wok_white.png" alt="Tom Tom Wok Logo">
            </div>
            <nav>
                <button class="nav-item active" data-view="dashboard">
                    <span class="nav-icon">üìä</span> Dashboard
                </button>
                <button class="nav-item" data-view="employees">
                    <span class="nav-icon">üë•</span> Empleados
                </button>
                <button class="nav-item" data-view="calculator">
                    <span class="nav-icon">üßÆ</span> Calculadora
                </button>
                <button class="nav-item" data-view="payroll">
                    <span class="nav-icon">üí∞</span> Planillas
                </button>
                <button class="nav-item" data-view="benefits">
                    <span class="nav-icon">‚öñÔ∏è</span> Prestaciones
                </button>
                <button class="nav-item" data-view="import">
                    <span class="nav-icon">üì•</span> Importar Excel
                </button>
                <button class="nav-item" data-view="profile">
                    <span class="nav-icon">‚öôÔ∏è</span> Mi Perfil
                </button>
            </nav>
            <div style="margin-top: auto; padding: 1rem;">
                <button class="btn" id="logout-btn"
                    style="width: 100%; justify-content: center; background: rgba(239, 68, 68, 0.1); color: var(--danger);">
                    üö™ Cerrar Sesi√≥n
                </button>
            </div>
            <div class="sidebar-footer">
                <p>¬© 2026 Tom Tom Wok</p>
            </div>
        </aside>

        <main class="content">
            <header>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button id="menu-toggle" class="menu-toggle">‚ò∞</button>
                    <h2 id="view-title">Dashboard</h2>
                </div>
                <div class="user-profile">
                    <span class="status-dot"></span>
                    <span class="username">Administrador</span>
                </div>
            </header>

            <div id="view-container">
                <!-- Views will be injected here -->
            </div>
        </main>
    </div>
    <dialog id="employee-modal">
        <div class="modal-content" style="max-height: 85vh; overflow-y: auto;">
            <button class="modal-close-btn" onclick="document.getElementById('employee-modal').close()">‚úï</button>
            <h3 id="modal-title" style="margin-bottom: 1.5rem">Registrar Empleado</h3>
            <form id="employee-form" style="display: flex; flex-direction: column; gap: 15px;">
                <input type="hidden" name="id" id="edit-emp-id">
                <div class="form-group">
                    <label>Nombre Completo</label>
                    <input type="text" name="name" placeholder="Ej: Juan P√©rez" required>
                </div>
                <div class="form-group">
                    <label>N√∫mero de C√©dula</label>
                    <input type="text" name="cedula" placeholder="Ej: 1-2345-6789">
                </div>
                <div class="form-group">
                    <label>Tel√©fono (WhatsApp)</label>
                    <input type="text" name="phone" placeholder="Ej: 50688888888">
                </div>
                <div class="form-group"
                    style="background: rgba(99,102,241,0.05); padding: 1rem; border-radius: 8px; border: 1px solid rgba(99,102,241,0.3);">
                    <label style="color: var(--primary); font-weight: 600;">üîê PIN de Acceso al Portal (4
                        d√≠gitos)</label>
                    <input type="text" name="pin" placeholder="Ej: 1234" maxlength="4" pattern="[0-9]*"
                        inputmode="numeric" style="margin-top: 0.5rem;">
                    <small
                        style="color: var(--text-muted); font-size: 0.75rem; display: block; margin-top: 0.5rem;">Este
                        PIN permite al empleado registrar sus horas en el portal de auto-servicio</small>
                </div>
                <div class="grid-2" style="gap: 1rem">
                    <div class="form-group">
                        <label>Cargo</label>
                        <input type="text" name="position" placeholder="Ej: Chef" required>
                    </div>
                    <div class="form-group">
                        <label>Pago por Hora (‚Ç°)</label>
                        <input type="number" name="hourlyRate" placeholder="3500" required>
                    </div>
                </div>
                <div class="grid-2" style="gap: 1rem">
                    <div class="form-group">
                        <label>Estado</label>
                        <select name="status">
                            <option value="Active">Activo</option>
                            <option value="Inactive">Inactivo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fecha Inicio</label>
                        <input type="date" name="startDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Fecha Terminaci√≥n (Opcional)</label>
                    <input type="date" name="endDate">
                </div>
                <div class="form-group"
                    style="display: flex; align-items: center; gap: 10px; background: rgba(99,102,241,0.05); padding: 10px; border-radius: 8px; border: 1px solid rgba(99,102,241,0.2); margin-bottom: 0.5rem;">
                    <input type="checkbox" name="applyCCSS" id="apply-ccss-check"
                        style="width: 20px; height: 20px; cursor: pointer;">
                    <label for="apply-ccss-check" style="margin: 0; cursor: pointer; font-weight: 600;">Aplicar
                        Rebajo CCSS (10.67%)</label>
                </div>

                <div class="form-group"
                    style="background: rgba(99,102,241,0.05); padding: 10px; border-radius: 8px; border: 1px solid rgba(99,102,241,0.2); margin-bottom: 0.5rem;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" name="enableOvertime" id="enable-ot-check"
                            style="width: 20px; height: 20px; cursor: pointer;" checked>
                        <label for="enable-ot-check"
                            style="margin: 0; cursor: pointer; font-weight: 600; color: var(--primary);">Habilitar
                            C√°lculo de Horas Extras</label>
                    </div>
                </div>

                <div class="grid-2"
                    style="gap: 1rem; background: rgba(99,102,241,0.05); padding: 1rem; border-radius: 8px; border: 1px solid rgba(99,102,241,0.2);">
                    <div class="form-group">
                        <label title="Horas m√°ximas antes de empezar a pagar extras">L√≠mite Horas Extra
                            (Semanales)</label>
                        <input type="number" name="overtimeThreshold" placeholder="48" step="0.5">
                    </div>
                    <div class="form-group">
                        <label title="N√∫mero por el que se multiplica el pago (ej: 1.5 es tiempo y medio)">Multiplicador
                            Extra (Ej: 1.5)</label>
                        <input type="number" name="overtimeMultiplier" placeholder="1.5" step="0.1">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex:1">Guardar</button>
                    <button type="button" class="btn btn-secondary" style="flex:1"
                        onclick="document.getElementById('employee-modal').close()">Cancelar</button>
                </div>
            </form>
        </div>
    </dialog>

    <dialog id="payroll-detail-modal">
        <div class="modal-content" style="max-width: 1100px; max-height: 85vh; overflow-y: auto;">
            <button class="modal-close-btn" onclick="document.getElementById('payroll-detail-modal').close()">‚úï</button>
            <h3 id="payroll-detail-title" style="margin-bottom: 1.5rem">Detalle de Pago</h3>
            <div id="payroll-detail-info"
                style="margin-bottom: 2rem; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 12px; border-left: 4px solid var(--primary);">
                <!-- Employee info here -->
            </div>
            <div class="table-container">
                <table style="font-size: 0.9rem;">
                    <thead>
                        <tr>
                            <th title="Fecha del registro">Fecha</th>
                            <th title="Hora de entrada">Entrada</th>
                            <th title="Hora de salida">Salida</th>
                            <th title="Paga doble por feriado">¬øDoble?</th>
                            <th title="Horas de almuerzo rebajadas">Almuerzo</th>
                            <th title="Total de horas laboradas">Horas Totales</th>
                            <th title="Monto neto a pagar">Monto Neto</th>
                        </tr>
                    </thead>
                    <tbody id="payroll-detail-body">
                        <!-- Log details here -->
                    </tbody>
                </table>
            </div>
            <div style="margin-top: 20px; display: flex; justify-content: flex-end;">
                <button class="btn btn-secondary"
                    onclick="document.getElementById('payroll-detail-modal').close()">Cerrar</button>
            </div>
        </div>
    </dialog>

    <dialog id="whatsapp-confirm-modal">
        <div class="modal-content" style="max-width: 450px;">
            <div style="text-align: center; margin-bottom: 1.5rem;">
                <div style="font-size: 3rem; margin-bottom: 0.5rem;">‚úÖ</div>
                <h3 style="color: var(--success);">WhatsApp Enviado</h3>
                <p style="color: var(--text-muted); font-size: 0.9rem;">El resumen se ha enviado correctamente.</p>
            </div>
            <div id="whatsapp-confirm-content"
                style="background: #075e54; color: white; padding: 1.5rem; border-radius: 12px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; white-space: pre-wrap; margin-bottom: 1.5rem; font-size: 0.95rem; line-height: 1.4; border-left: 4px solid #25d366;">
                <!-- Texto del mensaje aqu√≠ -->
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" style="flex: 1;"
                    onclick="document.getElementById('whatsapp-confirm-modal').close()">Aceptar</button>
            </div>
        </div>
    </dialog>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="main.js?v=15.1"></script>
    <!-- Modal para edici√≥n detallada de Log -->
    <dialog id="edit-log-modal" class="modal">
        <div class="modal-content" style="max-width: 700px">
            <button class="modal-close-btn" onclick="document.getElementById('edit-log-modal').close()">‚úï</button>
            <h3 id="edit-log-title" style="color: var(--primary); margin-bottom: 2rem">Editar Registro de Horas</h3>
            <form id="edit-log-form">
                <input type="hidden" name="logId">
                <div class="form-group">
                    <label>Fecha</label>
                    <input type="date" name="date" required>
                </div>
                <div class="grid-2" style="gap: 1rem">
                    <div class="form-group">
                        <label>Hora Entrada</label>
                        <input type="time" name="timeIn" required>
                    </div>
                    <div class="form-group">
                        <label>Hora Salida</label>
                        <input type="time" name="timeOut" required>
                    </div>
                </div>
                <div class="grid-2" style="gap: 1rem; margin-top: 1rem;">
                    <div class="form-group"
                        style="display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px;">
                        <input type="checkbox" name="isDoubleDay" id="edit-log-double"
                            style="width: 20px; height: 20px; cursor: pointer;">
                        <label for="edit-log-double" style="margin: 0; cursor: pointer;">D√≠a Doble</label>
                    </div>
                    <div class="form-group">
                        <label>Rebajos (Horas)</label>
                        <input type="number" name="deductionHours" step="0.1" min="0" value="0">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary" style="flex:1">Actualizar</button>
                    <button type="button" class="btn btn-secondary" style="flex:1"
                        onclick="document.getElementById('edit-log-modal').close()">Cancelar</button>
                </div>
            </form>
        </div>
    </dialog>

</body>

</html>